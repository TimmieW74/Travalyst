<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EU Regulatory Monitor - Travalyst</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #FFFFFF;
            color: rgb(13, 35, 31);
            line-height: 1.6;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e1e8ed;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .header h1 {
            color: rgb(13, 35, 31);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .notification-bell {
            position: relative;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .notification-bell:hover {
            background: rgba(246, 243, 234, 0.5);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-panel {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            width: 400px;
            max-height: 500px;
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .notification-panel.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .notification-header {
            background: rgba(246, 243, 234, 0.5);
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
        }

        .notification-header h3 {
            color: #00878A;
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
        }

        .email-section {
            padding: 0.5rem 0;
        }

        .email-section input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d9e0;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .email-section input:focus {
            outline: none;
            border-color: #00878A;
        }

        .legislation-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .legislation-item {
            display: flex;
            align-items: flex-start;
            padding: 0.75rem;
            border-bottom: 1px solid #f0f0f0;
            gap: 0.75rem;
        }

        .legislation-item:last-child {
            border-bottom: none;
        }

        .legislation-checkbox {
            margin-top: 0.2rem;
            cursor: pointer;
        }

        .legislation-info {
            flex: 1;
            cursor: pointer;
        }

        .legislation-title {
            font-weight: 500;
            color: rgb(13, 35, 31);
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .legislation-meta {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.2rem;
        }

        .notification-actions {
            padding: 1rem;
            border-top: 1px solid #e1e8ed;
            background: rgba(246, 243, 234, 0.3);
        }

        .save-notifications-btn {
            background: #00878A;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            width: 100%;
            transition: background 0.2s;
        }

        .save-notifications-btn:hover {
            background: #006b6e;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .page.active {
            display: block;
        }

        .page-header {
            background: rgb(13, 35, 31);
            color: white;
            padding: 2rem;
        }

        .page-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            opacity: 0.9;
        }

        .controls {
            padding: 1.5rem 2rem;
            background: rgba(246, 243, 234, 0.5);
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .search-bar {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d9e0;
            border-radius: 6px;
            font-size: 1rem;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #00878A;
            box-shadow: 0 0 0 3px rgba(0, 135, 138, 0.1);
        }

        .btn {
            background: rgb(13, 35, 31);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s;
        }

        .btn:hover {
            background: rgb(10, 28, 25);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .filters {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-shrink: 0;
        }

        .filter-select {
            padding: 0.5rem;
            border: 1px solid #d1d9e0;
            border-radius: 4px;
            background: white;
        }

        .export-btn {
            background: #199D6E;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .export-btn:hover {
            background: #147a59;
        }

        .legislation-table {
            width: 100%;
            border-collapse: collapse;
        }

        .legislation-table th {
            background: #FFFFFF;
            padding: 1rem;
            text-align: left;
            border-bottom: 2px solid #e1e8ed;
            font-weight: 600;
            color: rgb(13, 35, 31);
            position: relative;
        }

        .legislation-table th[onclick] {
            cursor: pointer;
        }

        .legislation-table th[onclick]:hover {
            background: #f8f9fa;
        }

        .legislation-table th[onclick]::after {
            content: '‚Üï';
            position: absolute;
            right: 8px;
            opacity: 0.5;
        }

        .legislation-table td {
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
            vertical-align: top;
            color: rgb(13, 35, 31);
        }

        .date-column {
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .status-column {
            white-space: nowrap;
        }

        .legislation-table tr {
            cursor: pointer;
            transition: background 0.2s;
        }

        .legislation-table tr:hover {
            background: #f8f9fa;
        }

        .priority-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: #fee2e2;
            color: #dc2626;
        }

        .priority-medium {
            background: #fef3c7;
            color: #d97706;
        }

        .priority-low {
            background: #ecfdf5;
            color: #059669;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            background: #e1e8ed;
            color: rgb(13, 35, 31);
        }

        .detail-content {
            padding: 2rem;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .back-btn {
            background: #666666;
        }

        .export-word-btn {
            background: #199D6E;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .export-word-btn:hover {
            background: #147a59;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .timeline-section {
            grid-column: 1 / -1;
            background: rgba(246, 243, 234, 0.5);
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .timeline-section h3 {
            color: #00878A;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .info-block {
            background: rgba(246, 243, 234, 0.5);
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .info-block h3 {
            color: #00878A;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .info-block .expandable-section h3 {
            color: #00878A;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .metadata-item {
            margin-bottom: 0.8rem;
        }

        .metadata-label {
            font-weight: 600;
            color: rgb(13, 35, 31);
            display: inline-block;
            width: 120px;
        }

        .timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            margin: 2rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: #e1e8ed;
            z-index: 1;
        }

        .timeline-step {
            background: white;
            border: 3px solid #e1e8ed;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .timeline-step.completed {
            background: #199D6E;
            border-color: #199D6E;
            color: white;
        }

        .timeline-step.current {
            background: #00878A;
            border-color: #00878A;
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 135, 138, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 135, 138, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 135, 138, 0); }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .timeline-label {
            font-size: 0.8rem;
            text-align: center;
            width: 80px;
            color: rgb(13, 35, 31);
        }

        .timeline-label.current {
            color: #00878A;
            font-weight: 600;
        }

        .text-content {
            line-height: 1.6;
            color: rgb(13, 35, 31);
        }

        .text-preview {
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .expand-btn {
            color: #00878A;
            cursor: pointer;
            border: none;
            background: none;
            text-decoration: underline;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .expand-btn:hover {
            color: #006b6e;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .modal h3 {
            color: #00878A;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .modal input {
            width: 100%;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border: 1px solid #d1d9e0;
            border-radius: 4px;
        }

        .login-gate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgb(13, 35, 31) 0%, #00878A 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-container {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .login-header h1 {
            color: rgb(13, 35, 31);
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .login-header p {
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form input {
            padding: 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #00878A;
            box-shadow: 0 0 0 3px rgba(0, 135, 138, 0.1);
        }

        .login-btn {
            background: rgb(13, 35, 31);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: rgb(10, 28, 25);
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .logout-btn {
            background: #666666;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .logout-btn:hover {
            background: #555555;
        }

        .main-app {
            min-height: 100vh;
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .timeline {
                flex-direction: column;
                gap: 1rem;
            }
            
            .timeline::before {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="loginGate" class="login-gate">
        <div class="login-container">
            <div class="login-header">
                <h1>üîí Access Required</h1>
                <p>Please verify your email to access the Travalyst EU Regulatory Monitor</p>
            </div>
            <form id="loginForm" class="login-form">
                <input type="email" id="emailInput" placeholder="Enter your email address" required>
                <button type="submit" class="login-btn">Verify Access</button>
            </form>
            <div id="errorMessage" class="error-message" style="display: none;">
                ‚ùå Access denied. Please contact your administrator for access.
            </div>
        </div>
    </div>

    <div id="mainApp" class="main-app" style="display: none;">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <h1>Travalyst EU Regulatory Monitor</h1>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="position: relative;">
                        <button class="notification-bell" onclick="toggleNotificationPanel()">
                            üîî
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <div class="notification-panel" id="notificationPanel">
                            <div class="notification-header">
                                <h3>üìß Notification Settings</h3>
                                <div class="email-section">
                                    <input type="email" id="notificationEmail" placeholder="Enter your email address">
                                </div>
                            </div>
                            <div class="legislation-list" id="notificationLegislationList">
                            </div>
                            <div class="notification-actions">
                                <button class="save-notifications-btn" onclick="saveNotificationSettings()">Save Notification Settings</button>
                            </div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div class="container">
            <div id="listPage" class="page active">
                <div class="page-header">
                    <h2>EU Legislation Monitor</h2>
                    <p>Track regulatory developments affecting sustainable travel and tourism</p>
                </div>
                
                <div class="controls">
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search legislation by keywords...">
                    </div>
                    <button class="btn" onclick="openModal()">Add Legislation</button>
                    <div class="filters">
                        <select class="filter-select" id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="Tourism">Tourism</option>
                            <option value="Accommodation">Accommodation</option>
                            <option value="Aviation">Aviation</option>
                            <option value="Rail">Rail</option>
                            <option value="Data">Data</option>
                            <option value="Reporting">Reporting</option>
                        </select>
                        <select class="filter-select" id="statusFilter">
                            <option value="">All Statuses</option>
                            <option value="Consultation">Consultation</option>
                            <option value="Proposal">Proposal</option>
                            <option value="EP Committee">EP Committee</option>
                            <option value="EP Plenary">EP Plenary</option>
                            <option value="Trilogue">Trilogue</option>
                            <option value="Adopted">Adopted</option>
                        </select>
                        <button class="export-btn" onclick="exportToExcel()">üìä Export to Excel</button>
                    </div>
                </div>

                <table class="legislation-table" id="legislationTable">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Doc Nr</th>
                            <th onclick="sortTable(2)">Category</th>
                            <th onclick="sortTable(3)">Type</th>
                            <th onclick="sortTable(4)">Status</th>
                            <th onclick="sortTable(5)">Impact Priority</th>
                            <th onclick="sortTable(6)">Last Updated</th>
                        </tr>
                    </thead>
                    <tbody id="legislationBody">
                    </tbody>
                </table>
            </div>

            <div id="detailPage" class="page">
                <div class="detail-content">
                    <div class="detail-header">
                        <button class="btn back-btn" onclick="showListPage()">‚Üê Back to List</button>
                        <button class="export-word-btn" onclick="exportToWord()">üìÑ Export to Word</button>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-block">
                            <h3>Legislation Metadata</h3>
                            <div id="metadataContent"></div>
                        </div>
                        
                        <div class="info-block">
                            <h3>Legislative Summary</h3>
                            <div class="expandable-section">
                                <div class="text-content" id="summaryContent">
                                </div>
                            </div>
                            
                            <div class="expandable-section" style="margin-top: 2rem;">
                                <h3>Impact Assessment</h3>
                                <div class="text-content" id="impactContent">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="timeline-section">
                        <h3>Legislative Timeline - Status</h3>
                        <div class="timeline" id="timeline"></div>
                        <div class="timeline-labels" id="timelineLabels"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="addModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h3>Add New Legislation</h3>
                <p>Paste the COM proposal URL below:</p>
                <input type="url" id="comUrl" placeholder="https://eur-lex.europa.eu/...">
                <br><br>
                <button class="btn" onclick="addLegislation()">Add Legislation</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

<script>
var VALID_EMAILS = ['tim@lobium.ai', 'keesjan.boonen@travalyst.org', 'ruveyda@lobium.ai'];
var isAuthenticated = false;
var legislationData = [
    {title: "EU draft Sustainable Tourism Strategy", docNr: "COM(2024)0125", category: "Tourism", type: "Communication", status: "Consultation", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/", ojDate: "2024-03-15", entryForce: "N/A", applicationDate: "N/A", currentStage: 0, 
    impact: "This strategy will directly shape how tourism sustainability is measured and reported across the EU. For Travalyst, this represents a critical opportunity to align our platform's metrics with official EU standards. The strategy will likely mandate specific sustainability indicators that tourism companies must report, which aligns perfectly with our mission to provide transparent, comparable sustainability data. Implementation could create new data requirements that our platform is uniquely positioned to address, potentially opening significant market opportunities in the EU tourism sector. The regulatory requirements will establish mandatory reporting frameworks that could benefit our business model significantly. As a leading provider of sustainability metrics in travel, we are well-positioned to help companies comply with the new requirements while enhancing consumer awareness of sustainable travel options. The strategy's emphasis on standardized measurement aligns with our core technology capabilities and could drive industry-wide adoption of our metrics framework.", 
    summary: "The EU's draft Sustainable Tourism Strategy aims to establish a comprehensive framework for measuring and promoting sustainable tourism practices across member states. The strategy focuses on creating standardized metrics for environmental impact, social responsibility, and economic sustainability in tourism. Key elements include mandatory sustainability reporting for large tourism operators, establishment of EU-wide certification schemes, and integration with the European Green Deal objectives. The strategy also proposes creating a European Tourism Sustainability Observatory to monitor progress and share best practices across the industry. This comprehensive approach will fundamentally change how tourism sustainability is measured and reported throughout Europe. The strategy includes provisions for consumer-facing sustainability information, enhanced transparency requirements, and financial incentives for businesses that demonstrate strong sustainability performance. Special emphasis is placed on reducing carbon emissions from tourism transportation, managing overtourism in popular destinations, and supporting local communities through responsible tourism practices. Implementation timelines suggest initial reporting requirements will begin in 2026, with full implementation by 2028."},
    {title: "Empowering Consumer Directive", docNr: "COM(2024)0825", category: "Tourism", type: "Directive", status: "Adopted", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/dir/2024/825/oj/eng", ojDate: "2024-04-22", entryForce: "2024-05-27", applicationDate: "2025-05-27", currentStage: 5, 
    impact: "This directive significantly enhances consumer rights in digital marketplaces, directly impacting how Travalyst and travel booking platforms operate. The directive requires clearer disclosure of sustainability claims, algorithmic transparency in search rankings, and stronger protection against greenwashing. This creates both challenges and opportunities: while compliance costs increase, the directive validates our approach to transparent sustainability reporting and could disadvantage less transparent competitors. Our platform's focus on verified sustainability data positions us well to help travel companies meet these new transparency requirements. The enhanced consumer protection measures will require significant updates to our platform interface and data presentation methods. Specifically, we will need to provide more detailed information about how our sustainability metrics are calculated, ensure all claims are backed by verifiable evidence, and potentially revise our search algorithms to comply with transparency requirements. The directive also creates new liabilities for platforms that permit unsubstantiated sustainability claims, making our verification processes increasingly valuable to partners.", 
    summary: "The Empowering Consumer Directive strengthens consumer protection in digital markets, with specific provisions affecting online travel platforms. Key requirements include mandatory disclosure of sustainability claims with verifiable evidence, transparency in how search results are ranked and personalized, and prohibition of dark patterns that mislead consumers about environmental impact. The directive also establishes stronger rights for consumers to access and port their data, and creates new obligations for platforms to clearly distinguish between organic and promoted content, particularly relevant for travel comparison sites. These changes will fundamentally alter how online travel platforms present information to consumers. The directive introduces significant penalties for non-compliance, including fines of up to 4% of annual turnover for serious or repeated violations. Companies have until May 2025 to implement the required changes, with mandatory third-party verification for environmental claims particularly impacting the travel sector. The directive specifically addresses the proliferation of sustainability labels, requiring standardized approaches to certification and prohibiting vague environmental claims without specific metrics or impacts. It also mandates disclosure of product lifespans and repairability information where relevant, though this has less direct impact on travel services."},
    {title: "Green Claims Directive", docNr: "COM(2023)0166", category: "Tourism", type: "Directive", status: "EP Committee", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=celex:52023PC0166", ojDate: "N/A", entryForce: "N/A", applicationDate: "N/A", currentStage: 2, 
    impact: "The Green Claims Directive is perhaps the most directly relevant legislation for Travalyst's core mission. It will require all environmental claims to be substantiated with scientific evidence and independently verified, directly addressing greenwashing in the travel industry. This regulation validates our approach to verified sustainability data and creates a mandatory market for our services. Travel companies will need third-party verification for any sustainability claims, positioning Travalyst as an essential service provider. The directive could transform the competitive landscape by making verified sustainability reporting mandatory rather than voluntary. Implementation will require significant investment in verification infrastructure and could create substantial new revenue streams for our platform. By establishing a regulatory framework that mandates the very services we provide, this directive represents both a validation of our business model and a massive growth opportunity. As one of the few companies with established methodologies for verifying travel sustainability claims, we are uniquely positioned to become a market leader in compliance services.", 
    summary: "The Green Claims Directive aims to combat greenwashing by establishing strict requirements for environmental claims made by businesses. Companies making green claims must provide scientific evidence to support their statements, undergo independent verification by accredited bodies, and use standardized methodologies for environmental impact assessment. The directive covers all sectors but has particular relevance for travel and tourism where sustainability claims are increasingly common but often unsubstantiated. It establishes penalties for misleading green claims and creates a harmonized framework across EU member states for environmental claim verification. This legislation will fundamentally change how companies communicate their environmental impact. The directive introduces a comprehensive verification system that requires pre-approval of environmental claims before they can be used in marketing or product information. It also establishes a public registry of approved claims and verification bodies, creating unprecedented transparency in environmental marketing. Companies will need to provide life-cycle assessments for product-based claims and demonstrate measurable impacts for process-based claims. The directive specifically targets vague terms like 'eco-friendly' or 'sustainable' by requiring them to be supported by specific, measurable environmental benefits that have been independently verified."},
    {title: "Product Environmental Footprint Category Rules", docNr: "COM(2024)0089", category: "Accommodation", type: "Technical Guidance", status: "Proposal", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/", ojDate: "N/A", entryForce: "N/A", applicationDate: "N/A", currentStage: 1, 
    impact: "PEFCR will establish the technical methodology for calculating environmental footprints across product categories, including accommodation services. This creates standardized metrics that Travalyst can implement across our platform, ensuring consistency and comparability. The rules will likely become the foundation for EU environmental reporting requirements, making early adoption crucial for competitive advantage. Our platform can help accommodation providers calculate and report their environmental footprint according to these official EU methodologies, creating a clear value proposition for compliance and transparency. The technical specifications will require significant development work but position us as the leading provider of EU-compliant sustainability metrics. By integrating these standardized methodologies into our platform, we can offer a seamless solution for travel companies to measure, report, and improve their environmental performance. This technical alignment will significantly enhance the credibility of our sustainability assessments and make our platform more valuable to both travelers and travel providers seeking standardized environmental information.", 
    summary: "The Product Environmental Footprint Category Rules provide detailed technical guidance for calculating environmental impacts across different product and service categories. For the accommodation sector, PEFCR establishes standardized methodologies for measuring carbon footprint, water usage, waste generation, and land use impacts. The rules specify data collection requirements, calculation methods, and reporting formats to ensure consistency across the EU. PEFCR serves as the technical foundation for various EU environmental policies and is expected to become mandatory for large companies under future legislation. These comprehensive technical standards will reshape how environmental impact is measured and reported across industries. The accommodation-specific PEFCR includes detailed methodologies for assessing key environmental impact categories including greenhouse gas emissions, water scarcity, land use, resource depletion, and waste production. It provides benchmark values for different accommodation types (hotels, hostels, vacation rentals) and star ratings, enabling meaningful comparison across the sector. The rules address both direct operational impacts and upstream supply chain emissions, requiring accommodation providers to collect data from energy providers, food suppliers, laundry services, and other key vendors. This creates a comprehensive view of environmental impact that goes beyond the traditional focus on energy and water consumption, encompassing the full life cycle of accommodation services."},
    {title: "CountEmissions EU", docNr: "COM(2023)0441", category: "Aviation", type: "Regulation", status: "Proposal", priority: "medium", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/legal-content/EN/PIN/?uri=CELEX:52023PC0441", ojDate: "N/A", entryForce: "N/A", applicationDate: "N/A", currentStage: 1, impact: "CountEmissions EU will mandate standardized emissions reporting for aviation, directly relevant to Travalyst's flight sustainability tracking capabilities.", summary: "CountEmissions EU establishes a comprehensive framework for monitoring emissions."},
    {title: "Revision of the Air Services Regulation", docNr: "COM(2025)1008", category: "Aviation", type: "Regulation", status: "Consultation", priority: "low", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2008/1008/oj/eng", ojDate: "N/A", entryForce: "N/A", applicationDate: "N/A", currentStage: 0, impact: "The revision of Air Services Regulation primarily focuses on market access and operational rights for airlines.", summary: "The revision of Regulation 1008/2008 updates the framework for air services within the EU."},
    {title: "RefuelEU Aviation", docNr: "COM(2023)2405", category: "Aviation", type: "Regulation", status: "Adopted", priority: "medium", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2023/2405/oj/eng", ojDate: "2023-10-31", entryForce: "2024-01-01", applicationDate: "2025-01-01", currentStage: 5, impact: "RefuelEU Aviation mandates increasing use of sustainable aviation fuels.", summary: "RefuelEU Aviation establishes mandatory targets for sustainable aviation fuel uptake."},
    {title: "Single Digital Booking and Ticketing Regulation", docNr: "COM(2024)0298", category: "Rail", type: "Regulation", status: "Trilogue", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2022/2065/oj/eng", ojDate: "N/A", entryForce: "N/A", applicationDate: "N/A", currentStage: 4, impact: "The SDBTR will revolutionize rail booking across Europe.", summary: "The Single Digital Booking and Ticketing Regulation aims to create seamless rail booking."},
    {title: "Multi-modal Digital Mobility Services Regulation", docNr: "COM(2024)0299", category: "Rail", type: "Regulation", status: "Proposal", priority: "medium", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=intcom:Ares%282022%295397025", ojDate: "N/A", entryForce: "N/A", applicationDate: "N/A", currentStage: 1, impact: "MDMS regulation supports the development of integrated mobility platforms.", summary: "The Multi-modal Digital Mobility Services Regulation establishes a framework for integrated digital mobility platforms."},
    {title: "Amendment to Rail Passengers Rights Regulation", docNr: "COM(2021)0782", category: "Rail", type: "Regulation", status: "Adopted", priority: "low", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2021/782/oj/eng", ojDate: "2021-06-07", entryForce: "2021-06-27", applicationDate: "2023-06-07", currentStage: 5, impact: "The amended Rail Passengers Rights Regulation primarily focuses on passenger compensation.", summary: "The amended Rail Passengers Rights Regulation strengthens passenger protection for rail travel."},
    {title: "Data Act", docNr: "COM(2023)2854", category: "Data", type: "Regulation", status: "Adopted", priority: "medium", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2023/2854/oj/eng", ojDate: "2023-12-11", entryForce: "2024-01-11", applicationDate: "2025-09-12", currentStage: 5, impact: "The Data Act will significantly impact how Travalyst accesses data.", summary: "The Data Act establishes comprehensive rules for data access and use."},
    {title: "AI Act", docNr: "COM(2024)1689", category: "Data", type: "Regulation", status: "Adopted", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2024/1689/oj/eng", ojDate: "2024-07-12", entryForce: "2024-08-01", applicationDate: "2025-08-02", currentStage: 5, impact: "The AI Act has significant implications for sustainability scoring.", summary: "The AI Act establishes comprehensive regulatory framework for AI systems."},
    {title: "Taxonomy Regulation", docNr: "COM(2020)0852", category: "Reporting", type: "Regulation", status: "Adopted", priority: "high", lastUpdated: "25-07-2025", url: "https://eur-lex.europa.eu/eli/reg/2020/852/oj/eng", ojDate: "2020-07-22", entryForce: "2020-07-12", applicationDate: "2022-01-01", currentStage: 5, impact: "The EU Taxonomy Regulation is highly relevant to Travalyst mission.", summary: "The EU Taxonomy Regulation establishes a classification system for sustainable activities."}
];
var currentLegislation = null;
var sortDirection = {};
var notificationSettings = {email: '', selectedLegislation: []};

try {
    var stored = JSON.parse(localStorage.getItem('travalyst-notifications') || '{}');
    notificationSettings = {email: stored.email || '', selectedLegislation: stored.selectedLegislation || []};
} catch (e) {
    console.warn('Failed to load notification settings');
}

function showLoginGate() {
    document.getElementById('loginGate').style.display = 'flex';
    document.getElementById('mainApp').style.display = 'none';
}

function showMainApp() {
    document.getElementById('loginGate').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    isAuthenticated = true;
    initializePage();
}

function handleLogin(event) {
    event.preventDefault();
    var emailInput = document.getElementById('emailInput');
    var email = emailInput.value.trim().toLowerCase();
    var errorMessage = document.getElementById('errorMessage');
    
    if (VALID_EMAILS.indexOf(email) !== -1) {
        localStorage.setItem('travalyst-auth-email', email);
        localStorage.setItem('travalyst-auth-timestamp', Date.now().toString());
        errorMessage.style.display = 'none';
        showMainApp();
    } else {
        errorMessage.style.display = 'block';
        emailInput.value = '';
        emailInput.focus();
    }
}

function logout() {
    localStorage.removeItem('travalyst-auth-email');
    localStorage.removeItem('travalyst-auth-timestamp');
    isAuthenticated = false;
    showLoginGate();
}

function checkAuthentication() {
    var storedEmail = localStorage.getItem('travalyst-auth-email');
    var authTimestamp = localStorage.getItem('travalyst-auth-timestamp');
    
    if (storedEmail && authTimestamp) {
        var twentyFourHours = 24 * 60 * 60 * 1000;
        var isStillValid = (Date.now() - parseInt(authTimestamp)) < twentyFourHours;
        
        if (isStillValid && VALID_EMAILS.indexOf(storedEmail.toLowerCase()) !== -1) {
            isAuthenticated = true;
            showMainApp();
            return;
        } else {
            localStorage.removeItem('travalyst-auth-email');
            localStorage.removeItem('travalyst-auth-timestamp');
        }
    }
    
    showLoginGate();
}

function toggleNotificationPanel() {
    var panel = document.getElementById('notificationPanel');
    if (panel.classList.contains('show')) {
        panel.classList.remove('show');
    } else {
        panel.classList.add('show');
        populateNotificationPanel();
    }
}

function populateNotificationPanel() {
    var emailInput = document.getElementById('notificationEmail');
    var legislationList = document.getElementById('notificationLegislationList');
    emailInput.value = notificationSettings.email || '';
    
    legislationList.innerHTML = legislationData.map(function(item) {
        var isChecked = notificationSettings.selectedLegislation.indexOf(item.docNr) !== -1;
        return '<div class="legislation-item"><input type="checkbox" id="notify-' + item.docNr + '" class="legislation-checkbox"' + (isChecked ? ' checked' : '') + ' onchange="updateLegislationSelection(\'' + item.docNr + '\', this.checked)"><div class="legislation-info" onclick="toggleCheckbox(\'notify-' + item.docNr + '\')"><div class="legislation-title">' + item.title + '</div><div class="legislation-meta">' + item.docNr + ' ‚Ä¢ ' + item.category + ' ‚Ä¢ ' + item.status + '</div></div></div>';
    }).join('');
}

function updateLegislationSelection(docNr, isSelected) {
    if (isSelected) {
        if (notificationSettings.selectedLegislation.indexOf(docNr) === -1) {
            notificationSettings.selectedLegislation.push(docNr);
        }
    } else {
        var index = notificationSettings.selectedLegislation.indexOf(docNr);
        if (index !== -1) {
            notificationSettings.selectedLegislation.splice(index, 1);
        }
    }
    updateNotificationBadge();
}

function toggleCheckbox(checkboxId) {
    var checkbox = document.getElementById(checkboxId);
    if (checkbox) {
        checkbox.checked = !checkbox.checked;
        var docNr = checkboxId.replace('notify-', '');
        updateLegislationSelection(docNr, checkbox.checked);
    }
}

function saveNotificationSettings() {
    var emailInput = document.getElementById('notificationEmail');
    var email = emailInput.value.trim();
    
    if (notificationSettings.selectedLegislation.length > 0 && (!email || !isValidEmail(email))) {
        alert('Please enter a valid email address to receive notifications');
        emailInput.focus();
        return;
    }
    
    notificationSettings.email = email;
    localStorage.setItem('travalyst-notifications', JSON.stringify(notificationSettings));
    
    var count = notificationSettings.selectedLegislation.length;
    if (count > 0 && email) {
        alert('Success! You will receive email notifications for ' + count + ' legislation' + (count === 1 ? '' : 's') + ' at ' + email);
    } else if (count === 0) {
        alert('Notification settings cleared - you will not receive any email notifications');
    }
    
    document.getElementById('notificationPanel').classList.remove('show');
    updateNotificationBadge();
}

function updateNotificationBadge() {
    var badge = document.getElementById('notificationBadge');
    var count = notificationSettings.selectedLegislation.length;
    
    if (count > 0) {
        badge.textContent = count;
        badge.style.display = 'flex';
    } else {
        badge.style.display = 'none';
    }
}

function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function renderLegislationTable() {
    var tbody = document.getElementById('legislationBody');
    var searchTerm = document.getElementById('searchInput').value.toLowerCase();
    var categoryFilter = document.getElementById('categoryFilter').value;
    var statusFilter = document.getElementById('statusFilter').value;

    var filteredData = legislationData.filter(function(item) {
        var matchesSearch = !searchTerm || item.title.toLowerCase().indexOf(searchTerm) !== -1 || item.docNr.toLowerCase().indexOf(searchTerm) !== -1 || item.category.toLowerCase().indexOf(searchTerm) !== -1;
        var matchesCategory = !categoryFilter || item.category === categoryFilter;
        var matchesStatus = !statusFilter || item.status === statusFilter;
        return matchesSearch && matchesCategory && matchesStatus;
    });

    if (tbody) {
        tbody.innerHTML = filteredData.map(function(item) {
            return '<tr onclick="showDetailPage(\'' + item.docNr + '\')"><td><div><strong>' + item.title + '</strong></div></td><td>' + item.docNr + '</td><td>' + item.category + '</td><td>' + item.type + '</td><td class="status-column"><span class="status-badge">' + item.status + '</span></td><td><span class="priority-badge priority-' + item.priority + '">' + item.priority + '</span></td><td class="date-column">' + item.lastUpdated + '</td></tr>';
        }).join('');
    }
}

function setupEventListeners() {
    var searchInput = document.getElementById('searchInput');
    var categoryFilter = document.getElementById('categoryFilter');
    var statusFilter = document.getElementById('statusFilter');

    if (searchInput) searchInput.addEventListener('input', renderLegislationTable);
    if (categoryFilter) categoryFilter.addEventListener('change', renderLegislationTable);
    if (statusFilter) statusFilter.addEventListener('change', renderLegislationTable);
}

function sortTable(columnIndex) {
    // Sorting functionality placeholder
}

function showDetailPage(docNr) {
    currentLegislation = legislationData.find(function(item) {
        return item.docNr === docNr;
    });
    
    if (!currentLegislation) return;

    document.getElementById('listPage').classList.remove('active');
    document.getElementById('detailPage').classList.add('active');

    document.getElementById('metadataContent').innerHTML = 
        '<div class="metadata-item"><span class="metadata-label">Title:</span> <a href="' + currentLegislation.url + '" target="_blank" style="color: #00878A;">' + currentLegislation.title + '</a></div>' +
        '<div class="metadata-item"><span class="metadata-label">Doc Nr:</span> ' + currentLegislation.docNr + '</div>' +
        '<div class="metadata-item"><span class="metadata-label">Category:</span> ' + currentLegislation.category + '</div>' +
        '<div class="metadata-item"><span class="metadata-label">Type:</span> ' + currentLegislation.type + '</div>' +
        '<div class="metadata-item"><span class="metadata-label">OJ Publication:</span> ' + currentLegislation.ojDate + '</div>' +
        '<div class="metadata-item"><span class="metadata-label">Entry into Force:</span> ' + currentLegislation.entryForce + '</div>' +
        '<div class="metadata-item"><span class="metadata-label">Application Date:</span> ' + currentLegislation.applicationDate + '</div>' +
        '<div class="metadata-item"><span class="metadata-label">Last Updated:</span> ' + currentLegislation.lastUpdated + '</div>';

    createTimeline();
    
    setExpandableText('summary', currentLegislation.summary);
    setExpandableText('impact', currentLegislation.impact);
}

function setExpandableText(type, content) {
    var words = content.split(' ');
    var previewWordCount = 50;
    
    var container = document.getElementById(type + 'Content');
    if (!container) return;

    if (words.length <= previewWordCount) {
        container.innerHTML = '<div>' + content + '</div>';
    } else {
        var preview = words.slice(0, previewWordCount).join(' ') + '...';
        var full = content;
        
        container.innerHTML = 
            '<div class="text-preview" id="' + type + 'Preview">' + preview + '</div>' +
            '<div id="' + type + 'Full" style="display: none;">' + full + '</div>' +
            '<button class="expand-btn" id="' + type + 'ExpandBtn" onclick="toggleText(\'' + type + '\')">Show more</button>';
    }
}

function createTimeline() {
    var stages = ['Consultation', 'Proposal', 'EP Committee', 'EP Plenary', 'Trilogue', 'Adopted'];
    var timeline = document.getElementById('timeline');
    var labels = document.getElementById('timelineLabels');

    if (timeline) {
        timeline.innerHTML = stages.map(function(stage, index) {
            var className = 'timeline-step';
            if (index < currentLegislation.currentStage) {
                className += ' completed';
            } else if (index === currentLegislation.currentStage) {
                className += ' current';
            }
            return '<div class="' + className + '">' + (index + 1) + '</div>';
        }).join('');
    }

    if (labels) {
        labels.innerHTML = stages.map(function(stage, index) {
            var className = 'timeline-label';
            if (index === currentLegislation.currentStage) {
                className += ' current';
            }
            return '<div class="' + className + '">' + stage + '</div>';
        }).join('');
    }
}

function showListPage() {
    document.getElementById('detailPage').classList.remove('active');
    document.getElementById('listPage').classList.add('active');
}

function openModal() {
    document.getElementById('addModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('addModal').style.display = 'none';
    document.getElementById('comUrl').value = '';
}

function addLegislation() {
    var url = document.getElementById('comUrl').value;
    if (url) {
        alert('Legislation would be added from: ' + url);
        closeModal();
    } else {
        alert('Please enter a valid COM proposal URL');
    }
}

function exportToWord() {
    alert('Export to Word functionality would be implemented here');
}

function exportToExcel() {
    alert('Export to Excel functionality would be implemented here');
}

function toggleText(type) {
    var preview = document.getElementById(type + 'Preview');
    var full = document.getElementById(type + 'Full');
    var btn = document.getElementById(type + 'ExpandBtn');

    if (!preview || !full || !btn) return;

    if (full.style.display === 'none' || !full.style.display) {
        preview.style.display = 'none';
        full.style.display = 'block';
        btn.textContent = 'Show less';
    } else {
        preview.style.display = 'block';
        full.style.display = 'none';
        btn.textContent = 'Show more';
    }
}

function initializePage() {
    renderLegislationTable();
    setupEventListeners();
    updateNotificationBadge();
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        var loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', handleLogin);
        }
        checkAuthentication();
    });
} else {
    var loginForm = document.getElementById('loginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
    }
    checkAuthentication();
}

window.onclick = function(event) {
    var modal = document.getElementById('addModal');
    if (event.target === modal) {
        closeModal();
    }
};
</script>
</body>
</html>
